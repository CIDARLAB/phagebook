<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Ordering</title>
    <link rel="shorcut icon" href="../styles/images/phagebookLogoMin_16x16.ico"/>
    <base href="/">
    <link rel="stylesheet" href="../styles/cssBootstrap/bootstrap.css"/>
    <link rel="stylesheet" href="../styles/clothoNavBar.css">
    <link rel="stylesheet" href="../styles/phagebookMainStyle.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
    
    <script src="../scripts/angular.js"></script>
    <script src="../scripts/jquery.js"></script>
    <script src="../scripts/lodash.js"></script>
    <script src="../scripts/ordering.js"></script>


    <script src= "https://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.min.js"></script>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/q.js/1.0.0/q.js"></script>
    <script src="https://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
    <script>
       
    $("document").ready( function() {
        $("#companyPopUp").dialog( {autoOpen:false});
        $("#productsPopUp").dialog({autoOpen:false});
        
        $("#productNameSearch").click( function ()
        {
           var productQuery = $('input[name=productQuery]').val();
           if (productQuery != ""){
                window.location.href = "/html/queryProduct.html?Name=" + productQuery;
            }
        
        });
        $("#companyNameSearch").click( function ()
        {
            var companyQuery = $('input[name=companyQuery]').val();
            if (companyQuery != ""){
            window.location.href = "/html/queryCompanyProduct.html?Name=" + companyQuery;
            }
        });
        
        if (getCookie("Order") !== ""){
            var idList = getCookie("Order"); //list of orders 
            
            
            $.ajax({
                    url: 'getProductById',
                    type: 'GET',
                    async: false,
                    data: {
                        'ids': idList
                    },
                    success: function (response) {
                        //Load Product Data'
                         sortProductsFromResponse(response);
                    },
                    error: function(){
                        //Nothing found or bad query
                        alert("NOPE");
                    }
                });
            }
     });
    
    function createOrder(ids){
         if (getCookie("Order") !== ""){
            var ids = getCookie("Order").split(',');
            var name = $("#orderNameBox").val();
            var description = $("#orderDescriptionBox").val();
            var idQuantityCombinations = {};
            var totalQuantityBoxes = totalNumberOfBoxesWithName("quantity");
            for (var i = 0; i < totalQuantityBoxes; i++)
            {
                idQuantityCombinations[ids[i]] = $("#quantity"+i+"").val();
            }
            
                    
            $.ajax({
                url: 'newOrder',
                type: 'POST',
                async: false,
                data :{
                    'orderIds' : JSON.stringify(idQuantityCombinations),
                    'name' : name,
                    'description' : description
                    
                },
                success: function (response) {
                    
                    
                    window.location.href = "/html/SelectColumns.html?orderId=" + response;
                },
                error: function(){ } 
            });
            
       }
    }
        
        
        
    
    
    
    function sortProductsFromResponse(response) {
            var ids = [];
            for (var i = 0; i < response.length; i++){
                //
                var productTable = document.getElementById("productTable");
                var row = productTable.insertRow(i+1);
                row.id = "product" + i.toString();
                
                var nameCell = row.insertCell(0);
                var companyCell = row.insertCell(1);
                var costCell = row.insertCell(2);
                var descriptionCell = row.insertCell(3);
                var goodTypeCell = row.insertCell(4);
                var productURLCell = row.insertCell(5);
                var quantityCell = row.insertCell(6);
                
                
                var name = response[i]['name'];
                //mkay
                var company = response[i]['company']['name'];
                var cost = response[i]['cost'];
                var description = response[i]['description'];
                var goodType = response[i]['goodType'];
                var productURL = response[i]['productURL'];
                var quantity = response[i]['quantity'];
                
                
                
              
                nameCell.innerHTML = name;
                companyCell.innerHTML = company;
                costCell.innerHTML = cost;
                descriptionCell.innerHTML = description;
                goodTypeCell.innerHTML = goodType;
                productURLCell.innerHTML = productURL;
                quantityCell.innerHTML = "<input type='number' class='quantity' id='quantity"+ i + "' min=0 max=1000></input>";
                
            }
        }
        function totalNumberOfBoxesWithName(name){
            var finished = false;
            
            var productNumber = 0;
           
            while (!finished){
                var checkbox = document.getElementById(name + productNumber);
                if (checkbox === null){
                    finished = true;
                } else {
                    //for clarity
                    finished = false;
                    productNumber++;
                }
                
            }
            
            return productNumber;
        }
     
    </script>
</head>
<body>
<div ng-module="clothoRoot">
    <div class="container">
        <div clotho-command-bar></div>
    </div>
    <terminal-aside></terminal-aside>
</div>

<div class="container-fluid" id="ordering">
    <!--<div ng-module="orderingApp">
        <div ng-controller="orderingCtrl">-->

            <div class = "mainContent">
                <div id="container">
                    <div id="orderingButtons">
                        <div id="products">
                            <input class="search" type="text" name="productQuery" placeholder="Product Name">
                            <input class="search btn btn-default" type="submit" id="productNameSearch" value="Search By Name">                   
                        </div>
                        <div id="companies">
                            <input class="search" type="text" name="companyQuery" placeholder="Company Name">
                            <input class="search btn btn-default" type="submit" id="companyNameSearch" value="Search By Company">
                        </div>
                    </div>
                    <br>
                    <br>
                   
                    <div>
                        <div id="nameBox"> 
                            Name: <input type="text" name="orderName" id="orderNameBox" placeholder="Order Name">
                        </div>
                        
                        <span id="description"> Description: </span>
                        <textarea name="orderDescription" id="orderDescriptionBox" placeholder="Please provide a small description for your order!" rows="4"></textarea>
                    </div>
                    <div id="orderList"> 
                        <span class="description">Current Order</span>
                        <br>
                        <table style="width:90%;  padding-left: 10px" id="productTable">
                        <tr>
                            <th>Product</th>
                            <th>Company</th>
                            <th>Cost</th>
                            <th>Description</th>
                            <th>Good Type</th>
                            <th>Product URL</th>
                            <th>Quantity</th>
                        </tr>
                    </table>
                    </div>
                    <input class="btn btn-default" type="submit" value="Place Order" onclick="createOrder()">
                </div>
                <div id="productsPopUp" title="Choose A Product"> <p class="container">Product Search</p>
                    
                
                
                </div>
                <div id="companyPopUp" title="Choose A Company"> <p class="container">Company Search</p>
                    
                
                </div>
            </div>
        <!--</div>
    </div>-->
</div>


<div class="modal-footer">
    Created by <a href="http://www.cidarlab.org" target="_blank">CIDAR at Boston University</a><br>
    Built by <a href="mailto:azulad7@bu.edu">Allison Z. Durkan</a><br>
    <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
</div>

 <!---SCRIPTS-->

<script src="../scripts/clotho/b18fc8c8.clotho-app-command.js"></script>
<script src="../scripts/clotho/c0f113c2.clotho-core-module.js"></script>
<!--note - remove all scripts below this for api-only build-->
<script type='text/javascript' src="../scripts/clotho/b18fc8c8.clotho-app-command.js"></script>
<script type='text/javascript' src="../scripts/clotho/c0f113c2.clotho-core-module.js"></script>
<script type='text/javascript' src="../scripts/clotho/c2a11f43.clotho-foundation-module.js"></script>
<script src="../scripts/clotho/clotho3API.js"></script>
<script src='../scripts/clotho/68a2b2df.clotho-command-module.js'></script>
<script src="../scripts/angular.ng-modules.js"></script>
<script src="../scripts/ordering.js"></script>

</body>
</html>
