<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Profile</title>
    <meta name="description" content="Clotho Lab Ordering">
    <meta name="viewport" content="width=1024, initial-scale=1">

    <!-- not necessary until serving outside root directory / want html5 mode -->
    <base href="/">

    <link rel="stylesheet" href="styles/2e84f2a0.command.css"/>
    <link rel="stylesheet" href="styles/773cbfe6.main.css"/>
    <link rel ="stylesheet" href="styles/Phagebook_Styles.css"/>

    <script src="bower_components/jquery/jquery.js"></script>

    <!-- note that angular is required for any clotho functionality -->
    <script src="bower_components/angular/angular.js"></script>
    <!-- note that lodash is required by several components -->
    <script src="bower_components/lodash/dist/lodash.js"></script>

    <script src= "https://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.min.js"></script>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/q.js/1.0.0/q.js"></script>
<style>
    #keyValueForm {
float: left;
        margin-left: 100px
        margin-right: 100px;
        background-color: white;
        text-align: left;
        padding: 8px;
    }
</style>
    <style>
        #friendBox{
            float: left;
            margin-left: auto;
            margin-right: auto;
            text-align: left;
            padding: 8px;
        }
    </style>

</head>

<body>
<div ng-app="clothoRoot">
    <div class="container">
        <div clotho-command-bar></div>
    </div>
    <terminal-aside></terminal-aside>
</div>
<div class = "contentBackground" ng-app = "profile">
    <div class = "mainContent">
        <div class = "leftColumn">
            <input type="file" id="imageupload" onchange="previewFile()"><br>
            <img src="" id="imagesource" alt="Image preview..." style = "width: 150px">
           <!-- <img src = "/images/people/kara_pro.PNG">-->
            <p id = "profileName"> </p>
            <p  id = "universityName"></p>
            <p  id = "positionName"></p>
            <div id = "phagebooklinks">
                <h4>
                    <a href="./Profile.html" class="col-xs-1" >News</a>
                    <a href="./Ordering.html" class="col-xs-1">Ordering</a>
                    <a href="./Profile_papers.html" class="col-xs-1">Papers</a>
                    <a href="./Projects.html" class="col-xs-1">Projects</a>
                    <a href="" class="col-xs-1">Parts</a> <br>
                    </h4>
            </div>
            <div class = inline-block>
                <p>Colleagues </p>
                <table id="friendBox" class="form-inline " style='margin-bottom: 10px;' role="form">
                    <tbody style="text-align: center;">
                </table>
            </div>
        </div>
        <div class = "rightColumn" >
<!--style="margin-left:-10px; margin-right:-10px; margin-top:-20px; margin-bottom:-100px; background-color:#e9eaed">-->
         <!--   <div style="background-image:url(/images/logo-CIDAR-2.png); background-repeat: no-repeat;">-->

            <div class="personalNews">
            <h3> Update your personal news, accomplishments, lab events. </h3>
                <ng-form id = "inputStatus">
                    <div>
                 <input id = "newStatus" name = "newStatus">
                    </div>
                <button id = "createStatus" class="normalButton" >Create</button><br>
                 </ng-form>
                <div class = inline-block>
                    <h3> Previous Posts</h3>
                    <table id="keyValueForm" class="form-inline" style='margin-bottom: 10px;width:800px;' role="form">
                        <tbody style="text-align: center;">
                    </table>
                </div>

                        <!-- {"id":"clotho.developer.katielewis1","name":"Katie Lewis","schema":"org.clothocad.model.PersonalProfile","institution":"Boston University","lab":"CIDAR","position":"Undergraduate","permission":"basic", "username":"kmlewis","projects":-->
            </div>
        </div>
    </div>
</div>

</div>
<!--------
SCRIPTS
--------->

<!--note - correct app based on the distribution, comments removed by build-->
<script type = "text/javascript">
        $("#createStatus").click(function () {
            //alert(window.name);
            var personID = window.name;
            //var personID = "clotho.developer.klefort";
            timeStamp = new Date();
            //timeStamp = Date.now();
            //alert(timeStamp)
           //var StatusObj = str.concat('"schema":', '"org.clothocad.phagebook.status"');//,', "entryDate":', '",document.getElementById("statusText").value' );
            var StatusObj = "{ \"schema\": \"org.clothocad.phagebook.status\", \"time\" :\"" + timeStamp + "\" , \"text\": \"" + document.getElementById("newStatus").value + "\" , \"person\": \"" + personID + "\" }";
            //alert(StatusObj);
            var obj = JSON.parse(StatusObj);
           // alert(obj);
           // alert(StatusObj);
            Clotho.create(obj).then(function(result){
                Clotho.get(personID).then(function(personObj) {
                    personObj.statuses.push(result);
                   Clotho.set(personObj);
            })
         });
        });
</script>
<!--<script>
    var reader = new FileReader();
    reader.onload = function(event) {
    var dataUri = event.target.result,
    img = document.createElement("img");
    img.src = dataUri;
    document.body.appendChild(img);
};

reader.onerror = function(event) {
console.error("File could not be read! Code " + event.target.error.code);
};

reader.readAsDataURL(file);
</script>

<script>
    function previewFile(){
        var preview = document.querySelector('img'); //selects the query named img
        var file    = document.querySelector('input[type=file]').files[0]; //sames as here
        var reader  = new FileReader();

        reader.onloadend = function () {
            preview.src = reader.result;
        }

        if (file) {
            reader.readAsDataURL(file); //reads the data as a URL
        } else {
            preview.src = "";
        }
    }

    previewFile();  //calls the function named previewFile()
</script>-->

<!--<script type= "text/javascript">
    /*$(document).ready(function(){
        {
            //alert('load page')
            var personID = "clotho.developer.klefort";
            alert(personID)
            Clotho.get(personID).then(function (personObj){
            alert(personObj.name)
            document.getElementById("profileName").innerHTML = personObj.name;
            });
        }
    })*/
</script>-->

<script>
    document.getElementById('imageupload').onchange = function (evt) {
        var tgt = evt.target || window.event.srcElement,
                files = tgt.files;

        // FileReader support
        if (FileReader && files && files.length) {
            var fr = new FileReader();
            fr.onload = function () {
                //alert("ping");
                document.getElementById('imagesource').src = fr.result;
            }
            fr.readAsDataURL(files[0]);
        }


        else {

        }
    }
</script>

<!--
<script>
    function previewFile(){
        //alert("ping");
        var preview = document.querySelector('img'); //selects the query named img
        var file    = document.querySelector('input[type=file]').files[0]; //sames as here
        var reader  = new FileReader();

        reader.onloadend = function () {
            preview.src = reader.result;
        }

        if (file) {
            reader.readAsDataURL(file); //reads the data as a URL
        } else {
            preview.src = "";
        }
    }

    previewFile();  //calls the function named previewFile()
</script>-->

<script type  = text/javascript>
$(document).ready(function() {
    //("#loadProfile").click(function () {
    var x = document.createElement("INPUT");
    x.setAttribute("type", "file");
    //alert(window.name);
    //var personID = document.getElementById("login").value;
    var personID = window.name;
 // var personID =   "clotho.developer.klefort";
    var statusObj;
    var notNullArray = [];
    Clotho.get(personID).then(function (personObj) {
                //alert(personObj.lastname);
                document.getElementById("profileName").innerHTML = personObj.firstname + " " + personObj.lastname;
                document.getElementById("universityName").innerHTML = personObj.institution;
                document.getElementById("positionName").innerHTML = personObj.position;
                //document.getElementById()
                Clotho.get(personObj.statuses).then(function (statusObj) {
                    if (personObj.statuses.length == null) {
                    }
                    else {
                        for (var i = statusObj.length - 1; i >= 0; i--) {

                            if (statusObj[i] == null) {
                                personObj.statuses[i] = [];
                            }
                            else {

                                notNullArray.push(i);
                                var paperCite = '';
                                var newStatus = statusObj[i];
                                $('#keyValueForm').append("<tr style='margin-top: 10px;'> <td>" + "<p>" + newStatus.text + "</p></td> <td>" + newStatus.time + "</td> < td > < button onclick = 'deletePaper(" + JSON.stringify(statusObj) + ") ' class= 'btn btn-primary'" + "> x </button></td></tr>");
                            }

                        }

                    }
                })
                if (personObj.friends.length == null) {
                    alert("null");
                }
                else {
                    for (var i = personObj.friends.length - 1; i >= 0; i--) {
                        //alert(personObj);
                        if (personObj.friends[i] == null) {
                            personObj.friends[i] = [];
                        }
                        else {
                            notNullArray.push(i);
                            var paperCite = '';
                            var newFriend = personObj.friends[i];

                            $('#friendBox').append("<tr style='margin-top: 10px;'> <td>" + "<a href = ./Profile.html>" + newFriend + "</a></td> </tr>");
                        }


                    }


                }
            }

    );


});
</script>



<script src="scripts/b18fc8c8.clotho-app-command.js"></script>

<script src="scripts/c0f113c2.clotho-core-module.js"></script>

<!--note - remove all scripts below this for api-only build-->

<script src="scripts/c2a11f43.clotho-foundation-module.js"></script>


<script src="scripts/68a2b2df.clotho-command-module.js"></script>

<!-- our custom app files -->
<script src="scripts/LabOrdering-app.js"></script>
<script src="scripts/Ordering.js"></script>
<script src="scripts/Tracking.js"></script>
<script src="scripts/orderingCtrl.js"></script>
<script src="scripts/clotho3API.js"></script>
<script src="scripts/sample/profileCtrl.js"></script>

</body>
</html>
